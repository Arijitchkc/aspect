# This is a ~ 1D test case for an insoluble fluid that is assigned
# a given amount (1%) of initial bound fluid. As the solid is 
# insoluble, all of the fluid should be released into the free
# fluid phase (porosity) field in a single (sufficiently large)
# `time step. 
set Adiabatic surface temperature          = 1600
set Nonlinear solver scheme                = iterated Advection and Stokes
set Output directory                       = reactive_fluid_transport_zero_solubility
set Max nonlinear iterations               = 1
set Nonlinear solver tolerance             = 1e-5

# The number of space dimensions you want to run this program in.
set Dimension                              = 2

set End time                               = 10e3

# Because the model includes reactions that might be on a faster time scale
# than the time step of the model (release of bound fluid into free fluid),
# we use the operator splitting scheme.
set Use operator splitting                     = true

subsection Solver parameters
  subsection Operator splitting parameters
    # We choose the size of the reaction time step as 100 years, small enough
    # so that it can accurately model melting and freezinddg.
    set Reaction time step                     = 1e2

    # Additionally, we always want to do at least 10 operator splitting time
    # steps in each model time step, to accurately compute the reactions.
    set Reaction time steps per advection step = 10
  end
end

# There are two compositional fields, one that tracks the amount of free fluid
# (the porosity) and one that tracks the amount of bound fluid (bound_fluid).
subsection Compositional fields
  set Number of fields = 2
  set Names of fields = porosity, bound_fluid
end

# Initially, there is no free water (the porosity is zero) and the water content
# of the material is 1%.
subsection Initial composition model
  set Model name = function
  subsection Function
    set Function expression = 0; 0.1
  end
end

# The composition is not fixed on any boundary
subsection Boundary composition model
  set Fixed composition boundary indicators = 
  set List of model names = initial composition
end

# Free slip on all sides
subsection Boundary velocity model
  set Tangential velocity boundary indicators = left, right, bottom, top
end

# The model is 0.2 km wide and extends 2 km in the vertical direction.
subsection Geometry model
  set Model name = box

  subsection Box
    set X extent  = 2e2
    set Y extent  = 2e3
    set Y repetitions = 10
  end

end


subsection Gravity model
  set Model name = vertical

  subsection Vertical
    set Magnitude = 10.0
  end

end

# The temperature is not important for this model, so we simply
# set it to 1600 K everywhere (including the boundary).
subsection Initial temperature model
  set Model name = function
  subsection Function
    set Function expression = 1600
  end
end

subsection Boundary temperature model
  set Fixed temperature boundary indicators   = top, bottom
  set List of model names = initial temperature

  subsection Initial temperature
    set Maximal temperature = 1600
    set Minimal temperature = 1600
  end
end


# The reactive fluid transport model is composited
# on top of the visco plastic material model.
subsection Material model
  set Model name = reactive fluid transport
  subsection Reactive Fluid Transport Model
    set Base model = visco plastic
    set Reference fluid density = 2995
    set Shear to bulk viscosity ratio = 0.1
    set Reference fluid viscosity = 10
    set Reference permeability = 2.5e-6
    set Exponential fluid weakening factor = 0
    set Fluid-solid reaction scheme = zero solubility
  end

  subsection Visco Plastic
    set Reference temperature                   = 1600
    set Prefactors for diffusion creep          = 5e-21

    set Viscous flow law = diffusion

    set Densities                   = 3000
    set Viscosity averaging scheme  = harmonic

    set Minimum viscosity           = 1e19
    set Maximum viscosity           = 1e19
  end
end


subsection Mesh refinement
  set Coarsening fraction                      = 0.0
  set Refinement fraction                      = 0.0

  set Initial adaptive refinement              = 0
  set Initial global refinement                = 0
  set Strategy                                 = composition
  set Time steps between mesh refinement       = 0
end


subsection Melt settings
  set Include melt transport                  = true
end


subsection Postprocess

  set List of postprocessors = composition statistics, melt statistics, velocity statistics

end
